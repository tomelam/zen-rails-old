<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>Accordion Widget Demo</title>
  
  <!-- only needed for test files: -->
  <style type="text/css">
    @import "../dojo/dojo/resources/dojo.css";
    @import "../dojo/dijit/tests/css/dijitTests.css";
  </style>
  
  <!-- required: the default dijit theme: -->
  <link id="themeStyles" rel="stylesheet"
	href="../dojo/dijit/themes/tundra/tundra.css">
    
  <!-- required: dojo.js -->
  <script type="text/javascript" src="../dojo/dojo/dojo.js"
	  djConfig="isDebug: true, parseOnLoad: true"></script>
  
  <!-- only needed for alternate theme testing: -->
  <script type="text/javascript"
	  src="../dojo/dijit/tests/_testCommon.js"></script>
  
  <script type="text/javascript">
    dojo.require("doh.runner");
    dojo.require("dijit.dijit"); // optimize: load dijit layer
    dojo.require("dijit.layout.AccordionContainer");
    dojo.require("dijit.layout.ContentPane");
      
      var accordion, pane4;
      
      var x = 1, accordion;
      
      dojo.addOnLoad(function(){doh.register(
	  "basic",
	  [
	      {
		  name: "1. Define zen.dojoWidget.startup",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      doh.assertEqual("function",
				      (typeof zen.dojoWidget.startup));
		  }
	      },
	      {
		  name: "2. Define zen.createDojoWidget",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      doh.assertEqual("function",
				      (typeof zen.createDojoWidget));
		  }
	      },
	      {
		  name: "3. Create a dijit.layout.ContentPane",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      var compon = zen.createDojoWidget(
			  "dijit.layout.ContentPane",
			  {style:{width:"40px", height:"50px",
				  backgroundColor:"green"},
			   id:
			   "green ContentPane 40 pixels wide and 50 pixels tall"
			  });
		      doh.assertNotEqual("undefined", compon);
		      doh.assertEqual("[object HTMLDivElement]",
				      compon.getDomNode());
		      doh.assertEqual(40, dojo.style(compon.domNode,"width"));
		      doh.assertEqual(50, dojo.style(compon.domNode,"height"));
		  }
	      },
	      {
		  name: "4. Create a dijit.layout.BorderContainer",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      var compon = zen.createDojoWidget(
			  "dijit.layout.BorderContainer",
			  {style:{width:"50px", height:"60px",
				  backgroundColor:"blue"},
			   id:"blue BorderContainer 50 x 60 pixels"});
		      doh.assertEqual("[object HTMLDivElement]",
				      compon.getDomNode());
		      doh.assertEqual(50, dojo.style(compon.domNode,"width"));
		      doh.assertEqual(60, dojo.style(compon.domNode,"height"));
		  }
	      },
	      {
		  name: "5. Create a dijit.layout.AccordionContainer",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      var compon = zen.createDojoWidget(
			  "dijit.layout.AccordionContainer",
			  {style:{width:"200px", height:"70px",
				  backgroundColor:"yellow"},
			   id:"yellow AccordionContainer 200 x 70 pixels"});
		      doh.assertEqual("[object HTMLDivElement]",
				      compon.getDomNode());
		      doh.assertEqual(200, dojo.style(compon.domNode,"width"));
		      doh.assertEqual(70, dojo.style(compon.domNode,"height"));
		  }
	      },
	      {
		  name: "6. Create an orange dijit.DialogUnderlay",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      var compon = zen.createDojoWidget(
			  "dijit.DialogUnderlay",
			  {style:{width:"500px", height:"20px",
				  backgroundColor:"orange"},
			   id:"orange DialogUnderlay 500 x 20 pixels"});
		      doh.assertEqual("[object HTMLDivElement]",
				      compon.getDomNode());
		      doh.assertEqual(500, dojo.style(compon.domNode,"width"));
		      doh.assertEqual(20, dojo.style(compon.domNode,"height"));
		  }
	      },
	      {
		  name: "7. Create a red dijit.layout.AccordionContainer",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      var compon = zen.createDojoWidget(
			  "dijit.layout.AccordionContainer",
			  {style:{width:"500px", height:"90px",
				  backgroundColor:"red"},
			   id:"red AccordionContainer 500 x 90 pixels"});
		      doh.assertEqual("[object HTMLDivElement]",
				      compon.getDomNode());
		      doh.assertEqual(500, dojo.style(compon.domNode,"width"));
		      doh.assertEqual(90, dojo.style(compon.domNode,"height"));
		  }
	      },
	      {
		  name: "8. Create a blue dojox.layout.FloatingPane",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      var compon = zen.createDojoWidget(
			  "dojox.layout.FloatingPane",
			  {style:{width:"500px", height:"100px",
				  backgroundColor:"blue"},
			   id:"blue FloatingPane 500 x pixels tall"});
		      doh.assertEqual("[object HTMLDivElement]",
				      compon.getDomNode());
		      doh.assertEqual(500, dojo.style(compon.domNode,"width"));
		      doh.assertEqual(100, dojo.style(compon.domNode,"height"));
		  }
	      },
	      {
		  name: "9. Find a gray Dojox ContentPane in the registry",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.domNode");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      var found,
		      compon = zen.createDojoWidget(
			  "dojox.layout.ContentPane",
			  {style:{width:"500px",
				  height:"20px", backgroundColor:"gray"},
			   id:"Dojo widget 1"});
		      compon.appendMyselfToParent(zen.body);
		      doh.assertEqual("[object HTMLDivElement]",
				      compon.getDomNode());
		      doh.assertEqual(500, dojo.style(compon.domNode,"width"));
		      doh.assertEqual(20, dojo.style(compon.domNode,"height"));
		      found = zen.dojoWidget.byId("Dojo widget 1");
		      doh.assertEqual("[object HTMLDivElement]",
				      found.getDomNode());
		      doh.assertEqual(500,
				      dojo.style(found.getDomNode(), "width"));
		      doh.assertEqual(20,
				      dojo.style(found.getDomNode(), "height"));
		      color = new dojo.Color(
			  dojo.style(found.getDomNode(), "backgroundColor"));
		      doh.assertEqual("#808080", color.toHex());
		  }
	      },
	      {
		  name:
		  "10. Do not create 2 Dojo widgets with the same 'id' string",
		  setUp: function() {
		      dojo.registerModulePath("zen", "../../../zen");
		      dojo.require("zen.domNode");
		      dojo.require("zen.dojoWidget");
		  },
		  runTest: function() {
		      var found, compon;
		      try {
			  compon = zen.createDojoWidget(
			      "dojox.layout.ContentPane",
			      {style:{width:"500px", height:"20px",
				      backgroundColor:"darkgray"},
			       id:"Dojo widget 1"});
		      } catch(e) {
		      };
		      doh.assertEqual(null, compon);
		  }
	      },
	      {
		  name: "11. Create",
		  runTest: function(t){
		      accordion = new dijit.layout.AccordionContainer(
			  {style: "width: 400px; height: 400px;"},
			  dojo.byId("accordionShell"));
		      dojo.forEach([ "pane 1", "pane 2", "pane 3" ],
				   function(title, i){
				       var content =
					   new dijit.layout.ContentPane(
					       {id: title, title: title,
						selected: i==1});
			  content.containerNode.innerHTML = "this is " + title;
			  accordion.addChild(content);
		      });
		      accordion.startup();
		      var titles = dojo.query(".dijitAccordionText",
					      accordion.domNode);
		      t.is(3, titles.length, "number of titles");
		      t.is("pane 3", titles[2].innerHTML);
		      
		      var children = accordion.getChildren();
		      t.is(3, children.length,
			   "number of children (ie, contentpanes)");
		  }
	      },
	      {
		  name: "initially open pane",
		  runTest: function(t){
		      // Pane 2 is initially open
		      var openPanes = dojo.query("> .dijitVisible",
						 accordion.containerNode);
		      t.is(1, openPanes.length, "exactly one open pane");
		      t.is("pane 2", dijit.byNode(openPanes[0]).title,
			   "pane 2 is initially open");
		      
		      // And others are closed
		      var closedPanes = dojo.query("> .dijitHidden",
						   accordion.containerNode);
		      t.is(2, closedPanes.length, "n-1 closed panes");
		  }
	      },
	      {
		  name: "addChild at end",
		  runTest: function(t){
		      pane4 = new dijit.layout.ContentPane(
			  {title: "pane 4", content: "this is pane 4"});
		      accordion.addChild(pane4);
		      
		      var titles = dojo.query(".dijitAccordionText",
					      accordion.domNode);
		      t.is(4, titles.length, "number of titles");
		      t.is("pane 4", titles[3].innerHTML);
		      
		      var children = accordion.getChildren();
		      t.is(4, children.length,
			   "number of children (ie, contentpanes)");
		      t.is(pane4, children[3],
			   "last child is the newly inserted one");
		  }
	      },
	      {
		  name: "addChild after pane 1",
		  runTest: function(t){
		      pane1half = new dijit.layout.ContentPane(
			  {id: "pane1half", title: "pane 1.5",
			   content: "this is pane 1.5"});
		      accordion.addChild(pane1half, 1);
		      
		      var titles = dojo.query(".dijitAccordionText",
					      accordion.domNode);
		      t.is(5, titles.length, "number of titles");
		      t.is("pane 1.5", titles[1].innerHTML);
		      
		      var children = accordion.getChildren();
		      t.is(5, children.length,
			   "number of children (ie, contentpanes)");
		      t.is(pane1half, children[1],
			   "second child is the newly inserted one");
		  }
	      },
	      {
		  name: "removeChild(pane 1.5)",
		  runTest: function(t){
		      accordion.removeChild(dijit.byId('pane1half'));
		      
		      var titles = dojo.query(".dijitAccordionText",
					      accordion.domNode);
		      t.is(4, titles.length, "number of titles");
		      t.is("pane 2", titles[1].innerHTML);
		      
		      var children = accordion.getChildren();
		      t.is(4, children.length,
			   "number of children (ie, contentpanes)");
		      t.is("pane 2", children[1].title,
			   "second child is again 'pane 2'");
		  }
	      },
	      {
		  name: "initially open pane (checking again)",
		  runTest: function(t){
		      // Pane 2 is initially open
		      var openPanes = dojo.query("> .dijitVisible",
						 accordion.containerNode);
		      t.is(1, openPanes.length, "exactly one open pane");
		      t.is("pane 2", dijit.byNode(openPanes[0]).title,
			   "pane 2 is initially open");
		      
		      // And others are closed
		      var closedPanes = dojo.query("> .dijitHidden",
						   accordion.containerNode);
		      t.is(3, closedPanes.length, "n-1 closed panes");
		  }
	      },
	      {
		  name: "select new pane",
		  timeout: 3000,
		  setUp: function(t){
		      // Note that this kicks off an animation so it
		      // might be a while before the bottom
		      // setTimeout() fires, likely longer than the
		      // 300ms specified
		      accordion.selectChild(dijit.byId('pane 3'));
		  },
		  runTest: function(t){
		      // Selecting pane 3 should open it and close pane 1
		      var d = new doh.Deferred();
		      setTimeout(d.getTestCallback(
			  function(){
			      // Pane 3 is now open
			      var openPanes = dojo.query(
				  "> .dijitVisible", accordion.containerNode);
			      t.is(1,
				   openPanes.length, "exactly one open pane");
			      t.is("pane 3",
				   dijit.byNode(openPanes[0]).title,
				   "pane 3 is now open");
			      
			      // And others are closed
			      var closedPanes = dojo.query(
				  "> .dijitHidden", accordion.containerNode);
			      t.is(3, closedPanes.length, "n-1 closed panes");
			  })
				 , 300);
		      return d;
		  }
	      }
	  ]);
          doh.run();
      });
  </script>
</head>
<body class="tundra" style="padding: 50px;">
  
  <h1 class="testTitle">AccordionContainer Tests</h1>
  
  <h2>Programatically created:</h2>
  <div id="accordionShell"></div>
  
  <button
      onclick="accordion.selectChild(pane4);">
    select pane 4
  </button>
  <button
      onclick="accordion.removeChild(dijit.byId('pane 3'));">
    remove pane 3
  </button>
  <button
      onclick="accordion.addChild(new dijit.layout.ContentPane({title: 'New pane ' + x++, content: 'Hello world!'}), 2);">
    Add pane as third child
  </button>
  <button
      onclick="accordion.addChild(new dijit.layout.ContentPane({title: 'New pane ' + x++, content: 'Hello world!'}));">
  Add pane at end
  </button>
  
</body>
</html>
